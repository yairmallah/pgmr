<html>
<head>
<title>video.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
.s5 { color: #629755; font-style: italic;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
video.py</font>
</center></td></tr></table>
<pre><span class="s0"># TODO: window alt</span>
<span class="s2">import </span><span class="s1">cv2</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">statistics</span>
<span class="s2">import </span><span class="s1">math</span>
<span class="s0"># from window import get_float</span>
<span class="s2">from </span><span class="s1">PIL </span><span class="s2">import </span><span class="s1">Image</span><span class="s2">, </span><span class="s1">ImageSequence</span>
<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">ffmpeg</span>

<span class="s0"># import colorsys</span>

<span class="s1">THRESHOLD_BORDERS = </span><span class="s3">127</span><span class="s2">, </span><span class="s3">255</span>
<span class="s1">COLOR_PRECISION = </span><span class="s3">5</span>
<span class="s1">LAYER_DIVISION = </span><span class="s3">60</span>
<span class="s1">BACKGROUND = </span><span class="s3">0</span>

<span class="s1">POINT_NUM = </span><span class="s3">5000</span>
<span class="s1">POINT_DIST = </span><span class="s3">5</span>
<span class="s1">BASE_DIR = </span><span class="s4">r&quot;C:\simData&quot;</span>


<span class="s2">def </span><span class="s1">cv_show_till_esc(img</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;image&quot;</span><span class="s1">):</span>
    <span class="s2">def </span><span class="s1">click_event(event</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">, </span><span class="s1">params):</span>
        <span class="s2">if </span><span class="s1">event == cv2.EVENT_LBUTTONDOWN:</span>
            <span class="s1">p1 = (y</span><span class="s2">, </span><span class="s1">x)</span>
            <span class="s1">print(</span><span class="s4">'p1 ='</span><span class="s2">, </span><span class="s1">p1)</span>
            <span class="s1">print(img[y</span><span class="s2">, </span><span class="s1">x])</span>
    <span class="s2">while </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s1">cv2.imshow(name</span><span class="s2">, </span><span class="s1">img)</span>
        <span class="s1">cv2.setMouseCallback(name</span><span class="s2">, </span><span class="s1">click_event)</span>
        <span class="s1">key = cv2.waitKey(</span><span class="s3">5</span><span class="s1">) &amp; </span><span class="s3">0xFF</span>
        <span class="s2">if </span><span class="s1">key == </span><span class="s3">27</span><span class="s1">:</span>
            <span class="s2">break</span>
    <span class="s1">cv2.destroyAllWindows()</span>


<span class="s2">def </span><span class="s1">cv_show_debug(img</span><span class="s2">, </span><span class="s1">name=</span><span class="s4">&quot;image&quot;</span><span class="s1">):</span>
    <span class="s1">im = cv2.resize(img</span><span class="s2">, </span><span class="s1">(</span><span class="s3">500</span><span class="s2">, </span><span class="s3">500</span><span class="s1">))</span>
    <span class="s2">def </span><span class="s1">click_event(event</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">, </span><span class="s1">params):</span>
        <span class="s2">if </span><span class="s1">event == cv2.EVENT_LBUTTONDOWN:</span>
            <span class="s1">p1 = (y</span><span class="s2">, </span><span class="s1">x)</span>
            <span class="s1">print(</span><span class="s4">'p1 ='</span><span class="s2">, </span><span class="s1">p1)</span>
            <span class="s1">print(im[y</span><span class="s2">, </span><span class="s1">x])</span>
    <span class="s2">while </span><span class="s3">1</span><span class="s1">:</span>
        <span class="s1">cv2.imshow(name</span><span class="s2">, </span><span class="s1">im)</span>
        <span class="s1">cv2.setMouseCallback(name</span><span class="s2">, </span><span class="s1">click_event)</span>
        <span class="s1">key = cv2.waitKey(</span><span class="s3">5</span><span class="s1">) &amp; </span><span class="s3">0xFF</span>
        <span class="s2">if </span><span class="s1">key == </span><span class="s3">27</span><span class="s1">:</span>
            <span class="s2">break</span>
    <span class="s1">cv2.destroyAllWindows()</span>


<span class="s2">def </span><span class="s1">to_pil(img: np.ndarray) -&gt; Image.Image:</span>
    <span class="s1">image = cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB)</span>
    <span class="s2">return </span><span class="s1">Image.fromarray(image)</span>


<span class="s2">def </span><span class="s1">remove_fill(img):</span>
    <span class="s1">blur = cv2.GaussianBlur(img</span><span class="s2">, </span><span class="s1">(</span><span class="s3">5</span><span class="s2">, </span><span class="s3">5</span><span class="s1">)</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">cv2.divide(blur</span><span class="s2">, </span><span class="s1">img</span><span class="s2">, </span><span class="s1">scale=</span><span class="s3">256.0</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">applay_alpha(img: np.ndarray</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">) -&gt; np.ndarray:</span>
    <span class="s0"># todo: simplify</span>
    <span class="s1">alpha = img[:</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">].astype(float) / </span><span class="s3">255</span>
    <span class="s1">print(alpha.shape)</span>
    <span class="s1">img = img[:</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s2">if </span><span class="s1">mode == </span><span class="s3">0</span><span class="s1">:</span>
        <span class="s1">cv2.imshow(</span><span class="s4">&quot;a1&quot;</span><span class="s2">, </span><span class="s1">img)</span>
        <span class="s1">img = cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2GRAY)</span>

    <span class="s1">bg = np.ones(img.shape) * BACKGROUND</span>
    <span class="s1">img = img.astype(float)</span>

    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(len(img)):</span>
        <span class="s2">for </span><span class="s1">j </span><span class="s2">in </span><span class="s1">range(img.shape[</span><span class="s3">1</span><span class="s1">]):</span>
            <span class="s1">img[i</span><span class="s2">, </span><span class="s1">j] *= bg[i</span><span class="s2">, </span><span class="s1">j] * (</span><span class="s3">1 </span><span class="s1">- alpha[i</span><span class="s2">, </span><span class="s1">j])</span>
    <span class="s2">return </span><span class="s1">img.astype(np.uint8)</span>


<span class="s2">def </span><span class="s1">imread_for_utf8(path</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">0</span><span class="s1">) -&gt; np.ndarray:</span>
    <span class="s5">&quot;&quot;&quot; 
    :param path: 
    :param mode: 0 if gray, else color 
    :return: 
    &quot;&quot;&quot;</span>
    <span class="s2">with </span><span class="s1">open(path</span><span class="s2">, </span><span class="s4">&quot;rb&quot;</span><span class="s1">) </span><span class="s2">as </span><span class="s1">stream:</span>
        <span class="s1">bytes = bytearray(stream.read())</span>
        <span class="s1">numpyarray = np.asarray(bytes</span><span class="s2">, </span><span class="s1">dtype=np.uint8)</span>
    <span class="s1">img = cv2.imdecode(numpyarray</span><span class="s2">, </span><span class="s1">cv2.IMREAD_UNCHANGED)</span>
    <span class="s2">if </span><span class="s1">img.ndim == </span><span class="s3">3</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">img.shape[-</span><span class="s3">1</span><span class="s1">] == </span><span class="s3">4</span><span class="s1">:</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s2">import </span><span class="s1">window</span>
                <span class="s0"># todo reopen</span>
                <span class="s2">if True</span><span class="s1">:  </span><span class="s0"># window.yes_no_window('alpha channel detected, do you want to slice?'):</span>
                    <span class="s1">print(</span><span class="s4">&quot;alpha sliced while reading&quot;</span><span class="s1">)</span>
                    <span class="s2">if </span><span class="s1">mode == </span><span class="s3">0</span><span class="s1">:</span>
                        <span class="s1">img = img[:</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s1">img = applay_alpha(img</span><span class="s2">, </span><span class="s1">mode=mode)</span>
                    <span class="s1">img = img[:</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]</span>
            <span class="s2">except </span><span class="s1">ImportError </span><span class="s2">as </span><span class="s1">err:</span>
                <span class="s1">print(err)</span>
                <span class="s1">print(</span><span class="s4">&quot;alpha sliced while reading&quot;</span><span class="s1">)</span>
                <span class="s1">img = img[:</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">:-</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s2">if </span><span class="s1">mode == </span><span class="s3">0</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">img.ndim == </span><span class="s3">3</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2GRAY)</span>
        <span class="s2">elif </span><span class="s1">img.ndim == </span><span class="s3">2</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">img</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">raise </span><span class="s1">ValueError(</span><span class="s4">&quot;image has unknown format. image is %s and has %d dimensions&quot; </span><span class="s1">% (str(type(img))</span><span class="s2">, </span><span class="s1">img.ndim))</span>
    <span class="s2">return </span><span class="s1">img</span>


<span class="s2">def </span><span class="s1">get_color_by_click(img: np.ndarray):</span>
    <span class="s1">img = cv2.resize(img</span><span class="s2">, </span><span class="s1">(</span><span class="s3">1000</span><span class="s2">, </span><span class="s3">800</span><span class="s1">))</span>
    <span class="s1">color = [</span><span class="s2">None</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">get_color(event</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">, </span><span class="s1">param):</span>
        <span class="s2">if </span><span class="s1">event == </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">color[</span><span class="s3">0</span><span class="s1">] </span><span class="s2">is None</span><span class="s1">:</span>
                <span class="s1">color[</span><span class="s3">0</span><span class="s1">] = img[y</span><span class="s2">, </span><span class="s1">x]</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">raise </span><span class="s1">RuntimeError(</span><span class="s4">&quot;gotten 2 colors&quot;</span><span class="s1">)</span>

    <span class="s1">cv2.namedWindow(</span><span class="s4">&quot;select colors&quot;</span><span class="s1">)</span>
    <span class="s1">cv2.setMouseCallback(</span><span class="s4">&quot;select colors&quot;</span><span class="s2">, </span><span class="s1">get_color)</span>
    <span class="s2">while </span><span class="s1">color[</span><span class="s3">0</span><span class="s1">] </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s1">cv2.imshow(</span><span class="s4">&quot;select colors&quot;</span><span class="s2">, </span><span class="s1">img)</span>
        <span class="s1">key = cv2.waitKey(</span><span class="s3">5</span><span class="s1">) &amp; </span><span class="s3">0xFF</span>
        <span class="s2">if </span><span class="s1">key == </span><span class="s3">27 </span><span class="s2">or </span><span class="s1">key == </span><span class="s3">13</span><span class="s1">:</span>
            <span class="s2">raise </span><span class="s1">Exception(</span><span class="s4">&quot;process terminated&quot;</span><span class="s1">)</span>
    <span class="s1">cv2.destroyAllWindows()</span>
    <span class="s2">return </span><span class="s1">color[</span><span class="s3">0</span><span class="s1">]</span>


<span class="s2">def </span><span class="s1">save_gif(dir_path: str</span><span class="s2">, </span><span class="s1">dest=</span><span class="s4">&quot;GIFED&quot;</span><span class="s2">, </span><span class="s1">dir_path_2=</span><span class="s4">&quot;&quot;</span><span class="s2">, </span><span class="s1">tim=</span><span class="s3">55</span><span class="s2">, </span><span class="s1">skip=</span><span class="s3">0</span><span class="s1">):</span>
    <span class="s1">imgs = []</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path):</span>

        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f[:-</span><span class="s3">4</span><span class="s1">]))  </span><span class="s0"># f.split(&quot;=&quot;)[1][:-4]</span>
        <span class="s2">if </span><span class="s1">skip != </span><span class="s3">0 </span><span class="s2">and </span><span class="s1">skip == int(skip):</span>
            <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(len(filenames)</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">):</span>
                <span class="s2">if </span><span class="s1">float(filenames[i][:-</span><span class="s3">4</span><span class="s1">]) % skip != </span><span class="s3">0</span><span class="s1">:</span>
                    <span class="s1">filenames.pop(i)</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fp = dir_path + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s0"># imgs.append(Image.open(fp))</span>
            <span class="s0"># for further manipulation</span>
            <span class="s1">fp = imread_for_utf8(fp</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">fp = cv2.cvtColor(fp</span><span class="s2">, </span><span class="s1">cv2.COLOR_RGB2BGR)</span>
            <span class="s1">imgs.append(Image.fromarray(fp))</span>
        <span class="s2">break</span>

    <span class="s2">if </span><span class="s1">dir_path_2 != </span><span class="s4">&quot;&quot;</span><span class="s1">:</span>
        <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path_2):</span>
            <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: -float(f.split(</span><span class="s4">&quot;=&quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">][:-</span><span class="s3">4</span><span class="s1">]))</span>
            <span class="s2">if </span><span class="s1">skip != </span><span class="s3">0 </span><span class="s2">and </span><span class="s1">skip == int(skip):</span>
                <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(len(filenames)</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">):</span>
                    <span class="s2">if </span><span class="s1">float(filenames[i][:-</span><span class="s3">4</span><span class="s1">]) % skip != </span><span class="s3">0</span><span class="s1">:</span>
                        <span class="s1">filenames.pop(i)</span>
            <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
                <span class="s1">fp = dir_path_2 + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
                <span class="s1">imgs.append(Image.open(fp))</span>
            <span class="s2">break</span>

    <span class="s1">img = imgs.pop(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">dest = dir_path + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ dest + </span><span class="s4">&quot;.gif&quot;</span>
    <span class="s1">print(</span><span class="s4">&quot;all but saved&quot;</span><span class="s1">)</span>
    <span class="s1">img.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'GIF'</span><span class="s2">, </span><span class="s1">append_images=imgs</span><span class="s2">, </span><span class="s1">save_all=</span><span class="s2">True, </span><span class="s1">duration=tim</span><span class="s2">, </span><span class="s1">loop=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">print(</span><span class="s4">&quot;generate gif succssecfully at &quot; </span><span class="s1">+ dest)</span>


<span class="s2">def </span><span class="s1">save_gif_multiple_folders(dir_paths: list</span><span class="s2">, </span><span class="s1">base_path=BASE_DIR</span><span class="s2">, </span><span class="s1">dest=</span><span class="s4">&quot;GIFED&quot;</span><span class="s2">, </span><span class="s1">tim=</span><span class="s3">55</span><span class="s1">):</span>
    <span class="s1">imgs = []</span>

    <span class="s2">for </span><span class="s1">dir_path_i </span><span class="s2">in </span><span class="s1">dir_paths:</span>
        <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path_i):</span>
            <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
                <span class="s1">fps = dir_path_i + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
                <span class="s1">imgs.append((Image.open(fps)</span><span class="s2">, </span><span class="s1">fp))</span>
    <span class="s1">imgs = sorted(imgs</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f[</span><span class="s3">1</span><span class="s1">].split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
    <span class="s2">for </span><span class="s1">img_and_index </span><span class="s2">in </span><span class="s1">range(len(imgs)):</span>
        <span class="s1">imgs[img_and_index] = imgs[img_and_index][</span><span class="s3">0</span><span class="s1">]</span>

    <span class="s1">img = imgs.pop(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">dest = base_path + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ dest + </span><span class="s4">&quot;.gif&quot;</span>
    <span class="s1">print(</span><span class="s4">&quot;all but saved&quot;</span><span class="s1">)</span>
    <span class="s1">img.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'GIF'</span><span class="s2">, </span><span class="s1">append_images=imgs</span><span class="s2">, </span><span class="s1">save_all=</span><span class="s2">True, </span><span class="s1">duration=tim</span><span class="s2">, </span><span class="s1">loop=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">print(</span><span class="s4">&quot;generate gif successfully at &quot; </span><span class="s1">+ dest)</span>


<span class="s2">def </span><span class="s1">save_gif_multiple_folders_loose(dir_paths: list</span><span class="s2">, </span><span class="s1">base_path=BASE_DIR</span><span class="s2">, </span><span class="s1">dest=</span><span class="s2">None, </span><span class="s1">tim=</span><span class="s3">50</span><span class="s1">):</span>
    <span class="s1">imgs = []</span>
    <span class="s2">if </span><span class="s1">dest </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s1">dest = </span><span class="s4">&quot;&quot;</span>
        <span class="s2">for </span><span class="s1">add </span><span class="s2">in </span><span class="s1">dir_paths:</span>
            <span class="s1">dest += str(os.path.basename(os.path.normpath(add))) + </span><span class="s4">&quot;_&quot;</span>
    <span class="s1">print(</span><span class="s4">f&quot;gif will save at </span><span class="s2">{</span><span class="s1">os.path.abspath(base_path)</span><span class="s2">}\\{</span><span class="s1">dest</span><span class="s2">}</span><span class="s4">.gif&quot;</span><span class="s1">)</span>
    <span class="s2">for </span><span class="s1">dir_path_i </span><span class="s2">in </span><span class="s1">dir_paths:</span>
        <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path_i):</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
            <span class="s2">except </span><span class="s1">Exception </span><span class="s2">as </span><span class="s1">e:</span>
                <span class="s1">print(dir_path_i)</span>
                <span class="s1">print(filenames)</span>
                <span class="s2">raise </span><span class="s1">e</span>
            <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
                <span class="s1">fps = dir_path_i + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
                <span class="s1">imgs.append(Image.open(fps))</span>
    <span class="s1">img = imgs.pop(</span><span class="s3">0</span><span class="s1">)</span>
    <span class="s1">dest = base_path + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ dest + </span><span class="s4">&quot;.gif&quot;</span>
    <span class="s1">print(</span><span class="s4">&quot;all but saved&quot;</span><span class="s1">)</span>
    <span class="s1">img.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'GIF'</span><span class="s2">, </span><span class="s1">append_images=imgs</span><span class="s2">, </span><span class="s1">save_all=</span><span class="s2">True, </span><span class="s1">duration=tim</span><span class="s2">, </span><span class="s1">loop=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">print(</span><span class="s4">&quot;generate gif successfully at &quot; </span><span class="s1">+ dest)</span>


<span class="s2">def </span><span class="s1">oop_img_to_img_sum(im1: np.ndarray</span><span class="s2">, </span><span class="s1">im2: np.ndarray</span><span class="s2">, </span><span class="s1">ratio=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)):</span>
    <span class="s2">if </span><span class="s1">len(im1.shape) == </span><span class="s3">2</span><span class="s1">:</span>
        <span class="s1">im1 = cv2.cvtColor(im1</span><span class="s2">, </span><span class="s1">cv2.COLOR_GRAY2BGR)</span>
    <span class="s2">if </span><span class="s1">len(im1.shape) == </span><span class="s3">2</span><span class="s1">:</span>
        <span class="s1">im2 = cv2.cvtColor(im2</span><span class="s2">, </span><span class="s1">cv2.COLOR_GRAY2BGR)</span>

    <span class="s1">im1 = im1.astype(np.float64) * ratio[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">im2 = im2.astype(np.float64) * ratio[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">im1 /= </span><span class="s3">255.0</span>
    <span class="s1">im2 /= </span><span class="s3">255.0</span>

    <span class="s1">image = np.clip(im1 + im2</span><span class="s2">, </span><span class="s3">0.0</span><span class="s2">, </span><span class="s3">1.0</span><span class="s1">)</span>

    <span class="s2">return </span><span class="s1">(image * </span><span class="s3">255</span><span class="s1">).astype(np.uint8)</span>


<span class="s2">def </span><span class="s1">oop_img_to_img_sum_mask_i1(im1: np.ndarray</span><span class="s2">, </span><span class="s1">im2: np.ndarray</span><span class="s2">, </span><span class="s1">ratio=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)):</span>
    <span class="s2">if </span><span class="s1">len(im1.shape) == </span><span class="s3">2</span><span class="s1">:</span>
        <span class="s1">im1 = cv2.cvtColor(im1</span><span class="s2">, </span><span class="s1">cv2.COLOR_GRAY2BGR)</span>
    <span class="s2">if </span><span class="s1">len(im1.shape) == </span><span class="s3">2</span><span class="s1">:</span>
        <span class="s1">im2 = cv2.cvtColor(im2</span><span class="s2">, </span><span class="s1">cv2.COLOR_GRAY2BGR)</span>

    <span class="s1">sub = op_thresh(im1</span><span class="s2">, </span><span class="s1">lim=</span><span class="s3">3</span><span class="s1">)</span>

    <span class="s1">im1 = im1.astype(np.float64) * ratio[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">sub = sub.astype(np.float64) * ratio[</span><span class="s3">0</span><span class="s1">]</span>
    <span class="s1">im2 = im2.astype(np.float64) * ratio[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">im1 /= </span><span class="s3">255.0</span>
    <span class="s1">sub /= </span><span class="s3">255.0</span>
    <span class="s1">im2 /= </span><span class="s3">255.0</span>
    <span class="s1">im2 *= sub</span>
    <span class="s1">image = im1 + im2</span>
    <span class="s2">return </span><span class="s1">(image * </span><span class="s3">255</span><span class="s1">).astype(np.uint8)</span>


<span class="s2">def </span><span class="s1">op_thresh(img</span><span class="s2">, </span><span class="s1">lim=</span><span class="s3">127</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">len(img.shape) &gt;= </span><span class="s3">3</span><span class="s1">:</span>
        <span class="s1">img = cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2GRAY)</span>
    <span class="s1">ret</span><span class="s2">, </span><span class="s1">threshed = cv2.threshold(img</span><span class="s2">, </span><span class="s1">lim</span><span class="s2">, </span><span class="s3">255</span><span class="s2">, </span><span class="s1">cv2.THRESH_BINARY)</span>
    <span class="s1">threshed = (</span><span class="s3">255</span><span class="s1">-threshed)</span>
    <span class="s2">return </span><span class="s1">cv2.cvtColor(threshed</span><span class="s2">, </span><span class="s1">cv2.COLOR_GRAY2BGR)</span>


<span class="s2">def </span><span class="s1">op_thresh_for_glow(img</span><span class="s2">, </span><span class="s1">lim=</span><span class="s3">127</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">len(img.shape) &gt;= </span><span class="s3">3</span><span class="s1">:</span>
        <span class="s1">img = cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2GRAY)</span>
    <span class="s1">img = (</span><span class="s3">255</span><span class="s1">-img)</span>
    <span class="s1">lim = </span><span class="s3">255</span><span class="s1">-lim</span>
    <span class="s1">ret</span><span class="s2">, </span><span class="s1">threshed = cv2.threshold(img</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">255</span><span class="s2">, </span><span class="s1">cv2.THRESH_BINARY_INV)</span>
    <span class="s1">threshed = (</span><span class="s3">255</span><span class="s1">-threshed)</span>
    <span class="s2">return </span><span class="s1">threshed</span>


<span class="s2">def </span><span class="s1">op_sketched(img: np.ndarray</span><span class="s2">, </span><span class="s1">k_size=</span><span class="s3">51</span><span class="s1">) -&gt; np.ndarray:</span>
    <span class="s5">&quot;&quot;&quot; 
    create an sketched image from base one 
    :param img: base image 
    :param k_size: blur factor. as it gets bigger, the sketch is in softer pencil. ODD!!! 
    :return: sketched image 
    &quot;&quot;&quot;</span>
    <span class="s0"># convert image to greyscale</span>
    <span class="s2">if </span><span class="s1">len(img.shape) &gt;= </span><span class="s3">3</span><span class="s1">:</span>
        <span class="s1">grey_img = cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2GRAY)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">grey_img = img</span>
    <span class="s1">blur_gray = cv2.GaussianBlur(grey_img</span><span class="s2">, </span><span class="s1">(k_size</span><span class="s2">, </span><span class="s1">k_size)</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span>

    <span class="s0"># divide the image with the blurred one to enhance the difference and delete the same</span>
    <span class="s1">sketched_img = cv2.divide(grey_img</span><span class="s2">, </span><span class="s1">blur_gray</span><span class="s2">, </span><span class="s1">scale=</span><span class="s3">256.0</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">sketched_img</span>


<span class="s2">def </span><span class="s1">op_glow(img: np.ndarray</span><span class="s2">, </span><span class="s1">k_size=</span><span class="s3">9</span><span class="s1">) -&gt; np.ndarray:</span>
    <span class="s5">&quot;&quot;&quot; 
    create an sketched image from base one 
    :param img: base image 
    :param k_size: blur factor. as it gets bigger, the sketch is in softer pencil. ODD!!! 
    :return: sketched image 
    &quot;&quot;&quot;</span>
    <span class="s0"># convert image to greyscale</span>
    <span class="s2">if </span><span class="s1">len(img.shape) &gt;= </span><span class="s3">3</span><span class="s1">:</span>
        <span class="s1">grey_img = cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2GRAY)</span>
    <span class="s2">else</span><span class="s1">:</span>
        <span class="s1">grey_img = img</span>
    <span class="s1">th = op_thresh_for_glow(img</span><span class="s2">, </span><span class="s1">lim=</span><span class="s3">254</span><span class="s1">)</span>
    <span class="s1">th = cv2.cvtColor(th</span><span class="s2">, </span><span class="s1">cv2.COLOR_GRAY2BGR)</span>
    <span class="s1">blur_gray = cv2.GaussianBlur(th</span><span class="s2">, </span><span class="s1">(k_size</span><span class="s2">, </span><span class="s1">k_size)</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">blur_gray</span>


<span class="s2">def </span><span class="s1">oop_img_to_folder(img_add: str</span><span class="s2">, </span><span class="s1">folder_add: str</span><span class="s2">, </span><span class="s1">oop=oop_img_to_img_sum</span><span class="s2">, </span><span class="s1">ratio=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dest_app=</span><span class="s4">&quot;added&quot;</span><span class="s1">):</span>
    <span class="s1">img = imread_for_utf8(img_add</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">os.makedirs(folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">i = </span><span class="s3">0</span>
        <span class="s1">rc = ratio</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fp = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fp</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">ratio = list(rc)</span>
            <span class="s2">if </span><span class="s1">type(ratio[</span><span class="s3">0</span><span class="s1">]) == type(</span><span class="s2">lambda </span><span class="s1">x: x):</span>
                <span class="s1">ratio[</span><span class="s3">0</span><span class="s1">] = ratio[</span><span class="s3">0</span><span class="s1">](i / len(filenames))</span>
            <span class="s2">if </span><span class="s1">type(ratio[</span><span class="s3">1</span><span class="s1">]) == type(</span><span class="s2">lambda </span><span class="s1">x: x):</span>
                <span class="s1">ratio[</span><span class="s3">1</span><span class="s1">] = ratio[</span><span class="s3">1</span><span class="s1">](i / len(filenames))</span>
            <span class="s1">image = oop(im1=img</span><span class="s2">, </span><span class="s1">im2=image</span><span class="s2">, </span><span class="s1">ratio=ratio)</span>
            <span class="s1">image = to_pil(image)</span>
            <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">i += </span><span class="s3">1</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">oop_img_to_folder_grad(img_add: str</span><span class="s2">, </span><span class="s1">folder_add: str</span><span class="s2">, </span><span class="s1">oop=oop_img_to_img_sum</span><span class="s2">, </span><span class="s1">grad=</span><span class="s2">lambda </span><span class="s1">x: </span><span class="s3">1</span><span class="s2">, </span><span class="s1">dest_app=</span><span class="s4">&quot;added&quot;</span><span class="s1">):</span>
    <span class="s1">img = imread_for_utf8(img_add</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>

    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">os.makedirs(folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">i = </span><span class="s3">0</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fp = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fp</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">image = oop(im1=img</span><span class="s2">, </span><span class="s1">im2=image</span><span class="s2">, </span><span class="s1">ratio=(grad(i / len(filenames))</span><span class="s2">, </span><span class="s3">1</span><span class="s1">))</span>
            <span class="s1">print(grad(i / len(filenames))</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
            <span class="s2">if </span><span class="s1">i % </span><span class="s3">50 </span><span class="s1">== </span><span class="s3">0</span><span class="s1">:</span>
                <span class="s1">cv_show_till_esc(image</span><span class="s2">, </span><span class="s1">name=str(i))</span>
            <span class="s1">image = to_pil(image)</span>
            <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">i += </span><span class="s3">1</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">oop_folder_to_folder_t(source_folder_add: str</span><span class="s2">, </span><span class="s1">target_folder_add: str</span><span class="s2">, </span><span class="s1">oop=oop_img_to_img_sum</span><span class="s2">, </span><span class="s1">ratio=(</span><span class="s3">1</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dest_app=</span><span class="s4">&quot;glowed&quot;</span><span class="s1">):</span>
    <span class="s1">os.makedirs(target_folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s1">base_set = {}</span>
    <span class="s1">target_set = {}</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(source_folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fpf = source_folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">base_set[int(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])] = image</span>
        <span class="s2">break</span>

    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(target_folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s2">for </span><span class="s1">fp</span><span class="s2">, </span><span class="s1">i </span><span class="s2">in </span><span class="s1">zip(filenames</span><span class="s2">, </span><span class="s1">range(len(filenames))):</span>
            <span class="s1">fpf = target_folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">target_set[int(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])] = image</span>
        <span class="s2">break</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">target_set.keys():</span>
        <span class="s2">if </span><span class="s1">i + </span><span class="s3">20 </span><span class="s2">in </span><span class="s1">base_set.keys():</span>
            <span class="s2">for </span><span class="s1">j </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">3</span><span class="s1">):</span>
                <span class="s2">if </span><span class="s1">j + i &gt;= len(target_set.keys()):</span>
                    <span class="s2">break</span>
                <span class="s1">target_set[i + j] = oop(im1=base_set[i + </span><span class="s3">20</span><span class="s1">]</span><span class="s2">, </span><span class="s1">im2=target_set[i + j]</span><span class="s2">, </span><span class="s1">ratio=ratio)</span>

    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">target_set.keys():</span>
        <span class="s1">dest = target_folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
        <span class="s1">image = to_pil(target_set[i])</span>
        <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">zip_sum_folders(f1_add: str</span><span class="s2">, </span><span class="s1">f2_add: str</span><span class="s2">, </span><span class="s1">base_dir=BASE_DIR</span><span class="s2">, </span><span class="s1">dest_app=</span><span class="s2">None, </span><span class="s1">clipped=</span><span class="s2">True, </span><span class="s1">strict=</span><span class="s2">True</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">dest_app </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s1">dest_app = </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">os.path.basename(os.path.normpath(f1_add))</span><span class="s2">}</span><span class="s4">_P_</span><span class="s2">{</span><span class="s1">os.path.basename(os.path.normpath(f2_add))</span><span class="s2">}</span><span class="s4">&quot;</span>
    <span class="s1">ims1 = []</span>
    <span class="s1">ims2 = []</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(f1_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fpf = f1_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">ims1.append((image</span><span class="s2">, </span><span class="s1">float(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])))</span>
        <span class="s2">break</span>

    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(f2_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fpf = f2_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">ims2.append((image</span><span class="s2">, </span><span class="s1">float(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])))</span>
        <span class="s2">break</span>

    <span class="s2">if </span><span class="s1">len(ims1) != len(ims2):</span>
        <span class="s2">raise </span><span class="s1">ValueError(</span><span class="s4">f&quot;folders have different sizes, got </span><span class="s2">{</span><span class="s1">len(ims1)</span><span class="s2">}</span><span class="s4">, </span><span class="s2">{</span><span class="s1">len(ims2)</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s1">)</span>
    <span class="s1">os.makedirs(base_dir + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(len(ims1)):</span>
        <span class="s2">if </span><span class="s1">strict:</span>
            <span class="s2">if </span><span class="s1">ims1[i][</span><span class="s3">1</span><span class="s1">] != ims2[i][</span><span class="s3">1</span><span class="s1">]:</span>
                <span class="s2">raise </span><span class="s1">ValueError(</span><span class="s4">f&quot;folders have different names, got </span><span class="s2">{</span><span class="s1">ims1[i][</span><span class="s3">1</span><span class="s1">]</span><span class="s2">}</span><span class="s4">, </span><span class="s2">{</span><span class="s1">ims1[i][</span><span class="s3">1</span><span class="s1">]</span><span class="s2">} </span><span class="s4">at index </span><span class="s2">{</span><span class="s1">i</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s1">)</span>
            <span class="s2">if </span><span class="s1">clipped:</span>
                <span class="s1">image = oop_img_to_img_sum(ims1[i][</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ims2[i][</span><span class="s3">0</span><span class="s1">])</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">image = ims1[i][</span><span class="s3">0</span><span class="s1">] + ims2[i][</span><span class="s3">0</span><span class="s1">]</span>
            <span class="s1">image = to_pil(image)</span>
            <span class="s1">dest = base_dir + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">base_dir + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app</span>


<span class="s2">def </span><span class="s1">oop_zip_folders(f1_add: str</span><span class="s2">, </span><span class="s1">f2_add: str</span><span class="s2">, </span><span class="s1">base_dir=BASE_DIR</span><span class="s2">, </span><span class="s1">dest_app=</span><span class="s2">None, </span><span class="s1">oop=oop_img_to_img_sum</span><span class="s2">, </span><span class="s1">strict=</span><span class="s2">True</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">dest_app </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s1">dest_app = </span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">os.path.basename(os.path.normpath(f1_add))</span><span class="s2">}</span><span class="s4">_P_</span><span class="s2">{</span><span class="s1">os.path.basename(os.path.normpath(f2_add))</span><span class="s2">}</span><span class="s4">&quot;</span>
    <span class="s1">ims1 = []</span>
    <span class="s1">ims2 = []</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(f1_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fpf = f1_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">ims1.append((image</span><span class="s2">, </span><span class="s1">float(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])))</span>
        <span class="s2">break</span>

    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(f2_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fpf = f2_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">ims2.append((image</span><span class="s2">, </span><span class="s1">float(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])))</span>
        <span class="s2">break</span>

    <span class="s2">if </span><span class="s1">len(ims1) != len(ims2):</span>
        <span class="s2">raise </span><span class="s1">ValueError(</span><span class="s4">f&quot;folders have different sizes, got </span><span class="s2">{</span><span class="s1">len(ims1)</span><span class="s2">}</span><span class="s4">, </span><span class="s2">{</span><span class="s1">len(ims2)</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s1">)</span>
    <span class="s1">os.makedirs(base_dir + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>

    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(len(ims1)-</span><span class="s3">1</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s1">-</span><span class="s3">1</span><span class="s1">):</span>
        <span class="s2">if </span><span class="s1">strict:</span>
            <span class="s2">if </span><span class="s1">ims1[i][</span><span class="s3">1</span><span class="s1">] != ims2[i][</span><span class="s3">1</span><span class="s1">]:</span>
                <span class="s2">raise </span><span class="s1">ValueError(</span><span class="s4">f&quot;folders have different names, got </span><span class="s2">{</span><span class="s1">ims1[i][</span><span class="s3">1</span><span class="s1">]</span><span class="s2">}</span><span class="s4">, </span><span class="s2">{</span><span class="s1">ims1[i][</span><span class="s3">1</span><span class="s1">]</span><span class="s2">} </span><span class="s4">at index </span><span class="s2">{</span><span class="s1">i</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s1">)</span>
            <span class="s1">image = oop(ims1[i][</span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">ims2[i][</span><span class="s3">0</span><span class="s1">])</span>
            <span class="s1">image = to_pil(image)</span>
            <span class="s1">dest = base_dir + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_app + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">padd_folder(folder_add: str</span><span class="s2">, </span><span class="s1">time_add: float</span><span class="s2">, </span><span class="s1">tim=</span><span class="s3">50.0</span><span class="s1">):</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">lst_img_name = filenames[len(filenames)-</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s1">print(</span><span class="s4">&quot;last image to multiply: &quot; </span><span class="s1">+ lst_img_name)</span>
        <span class="s1">lst_img_n = int(lst_img_name.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])</span>
        <span class="s1">count = math.ceil(time_add / (tim / </span><span class="s3">1000</span><span class="s1">))</span>
        <span class="s1">print(</span><span class="s4">&quot;preforming &quot; </span><span class="s1">+ str(count) + </span><span class="s4">&quot; multiplication&quot;</span><span class="s1">)</span>

        <span class="s1">image = imread_for_utf8((folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ lst_img_name)</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">image = cv2.cvtColor(image</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB)</span>
        <span class="s1">image = Image.fromarray(image)</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(count):</span>
            <span class="s1">j = i + </span><span class="s3">1 </span><span class="s1">+ lst_img_n</span>
            <span class="s1">dest = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(j) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">interpolate_folder(folder_add: str):</span>
    <span class="s1">imgs_indx = []</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">imgs_indx.append(int(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
    <span class="s1">last_img = imread_for_utf8((folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(</span><span class="s3">0</span><span class="s1">) + </span><span class="s4">&quot;.png&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">last_img = to_pil(last_img)</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(imgs_indx[len(imgs_indx) - </span><span class="s3">1</span><span class="s1">]):</span>
        <span class="s2">if </span><span class="s1">i </span><span class="s2">in </span><span class="s1">imgs_indx:</span>
            <span class="s1">last_img = imread_for_utf8((folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">last_img = to_pil(last_img)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">dest = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">last_img.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>




<span class="s2">def </span><span class="s1">shift_folder(folder_add: str</span><span class="s2">, </span><span class="s1">shifter: int</span><span class="s2">, </span><span class="s1">dest_add=</span><span class="s4">&quot;shifted&quot;</span><span class="s1">):</span>
    <span class="s0"># TODO second iteration raises error</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">os.makedirs((folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_add)</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">i = </span><span class="s3">0</span>

        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fp = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fp</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">image = cv2.cvtColor(image</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB)</span>
            <span class="s1">image = Image.fromarray(image)</span>
            <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i + shifter) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">i += </span><span class="s3">1</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>
        <span class="s2">break</span>

<span class="s2">def </span><span class="s1">save_series(ser: list</span><span class="s2">, </span><span class="s1">loc: str):</span>
    <span class="s1">os.makedirs(loc</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">for </span><span class="s1">im</span><span class="s2">, </span><span class="s1">i </span><span class="s2">in </span><span class="s1">zip(ser</span><span class="s2">, </span><span class="s1">range(len(ser))):</span>
        <span class="s1">im = to_pil(im)</span>
        <span class="s1">dest = loc + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
        <span class="s1">im.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>
    <span class="s2">return </span><span class="s1">loc</span>


<span class="s2">def </span><span class="s1">basic_avg(im1: np.ndarray</span><span class="s2">, </span><span class="s1">im2: np.ndarray</span><span class="s2">, </span><span class="s1">frame_n=</span><span class="s3">40</span><span class="s1">):</span>
    <span class="s1">im1 = im1.astype(float)</span>
    <span class="s1">im2 = im2.astype(float)</span>
    <span class="s1">frames = []</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(frame_n):</span>
        <span class="s1">frames.append((im2 * i / frame_n + im1 * (</span><span class="s3">1 </span><span class="s1">- i / frame_n)).astype(np.uint8))</span>
    <span class="s2">return </span><span class="s1">frames</span>


<span class="s2">def </span><span class="s1">blend_img_on_folder(img: np.ndarray</span><span class="s2">, </span><span class="s1">folder_add: str</span><span class="s2">, </span><span class="s1">mod=</span><span class="s3">1</span><span class="s2">, </span><span class="s1">ratio=</span><span class="s3">1</span><span class="s1">):</span>
    <span class="s2">def </span><span class="s1">method(im1: np.ndarray</span><span class="s2">, </span><span class="s1">im2: np.ndarray):</span>
        <span class="s2">if </span><span class="s1">mod == </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s1">im1 = im1.astype(float) / </span><span class="s3">255</span>
            <span class="s1">im2 = im2.astype(float) / </span><span class="s3">255</span>

            <span class="s1">mask = im1 &gt;= </span><span class="s3">0.5  </span><span class="s0"># generate boolean mask of everywhere a &gt; 0.5</span>
            <span class="s1">ab = np.zeros_like(im1)  </span><span class="s0"># generate an output container for the blended image</span>

            <span class="s0"># now do the blending</span>
            <span class="s1">ab[~mask] = (</span><span class="s3">2 </span><span class="s1">* im1 * im2)[~mask]  </span><span class="s0"># 2ab everywhere a&lt;0.5</span>
            <span class="s1">ab[mask] = (</span><span class="s3">1 </span><span class="s1">- </span><span class="s3">2 </span><span class="s1">* (</span><span class="s3">1 </span><span class="s1">- im1) * (</span><span class="s3">1 </span><span class="s1">- im2))[mask]  </span><span class="s0"># else this</span>
            <span class="s1">ab *= </span><span class="s3">255</span>
            <span class="s1">ab = ab.astype(np.uint8)</span>
            <span class="s2">return </span><span class="s1">ab</span>
        <span class="s2">if </span><span class="s1">mod == </span><span class="s3">2</span><span class="s1">:</span>
            <span class="s1">im1 = im1.astype(float) / </span><span class="s3">255</span>
            <span class="s1">im2 = im2.astype(float) / </span><span class="s3">255</span>
            <span class="s1">im1 = </span><span class="s3">255 </span><span class="s1">- im1</span>
            <span class="s1">im2 = </span><span class="s3">255 </span><span class="s1">- im2</span>
            <span class="s1">res = cv2.multiply(im1</span><span class="s2">, </span><span class="s1">im2)</span>
            <span class="s1">res = (</span><span class="s3">1 </span><span class="s1">- res) * </span><span class="s3">255</span>
            <span class="s2">return </span><span class="s1">res.astype(np.uint8)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">raise </span><span class="s1">Exception(</span><span class="s4">&quot;no other blended defined yet&quot;</span><span class="s1">)</span>

    <span class="s1">img = img.astype(np.float64) * ratio</span>
    <span class="s0"># img = img.astype(np.uint8)</span>
    <span class="s0"># for preserved color img = cv2.cvtColor(img, cv2.COLOR_GRAY2BGR)</span>

    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: -float(f[:-</span><span class="s3">4</span><span class="s1">]))  </span><span class="s0"># .split(&quot;=&quot;)[1][:-4]</span>
        <span class="s1">os.mkdir(folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">added&quot;</span><span class="s1">)</span>
        <span class="s1">i = </span><span class="s3">0</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fp = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fp</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">0</span><span class="s1">)</span>
            <span class="s1">image = image.astype(np.float64)</span>
            <span class="s1">image = method(image</span><span class="s2">, </span><span class="s1">img)</span>
            <span class="s1">image = Image.fromarray(image)</span>
            <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">added&quot; </span><span class="s1">+ </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">i += </span><span class="s3">1</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">img_save(img: np.ndarray</span><span class="s2">, </span><span class="s1">dest: str</span><span class="s2">, </span><span class="s1">form: str = </span><span class="s4">'PNG'</span><span class="s1">):</span>
    <span class="s1">img = cv2.cvtColor(img</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB)</span>
    <span class="s1">img = Image.fromarray(img)</span>
    <span class="s1">img.save(fp=dest</span><span class="s2">, </span><span class="s1">format=form)</span>


<span class="s2">def </span><span class="s1">sum_folders(folder_adds: list</span><span class="s2">, </span><span class="s1">dest_add: str):</span>
    <span class="s1">ims = {}</span>
    <span class="s1">lns = []</span>
    <span class="s2">for </span><span class="s1">folder_add </span><span class="s2">in </span><span class="s1">folder_adds:</span>
        <span class="s1">ims[folder_add] = []</span>
        <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
            <span class="s1">print(filenames)</span>
            <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: -float(f[:-</span><span class="s3">4</span><span class="s1">]))</span>
            <span class="s1">print(filenames)</span>
            <span class="s1">i = </span><span class="s3">0</span>
            <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
                <span class="s1">fp = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
                <span class="s1">image = imread_for_utf8(fp</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
                <span class="s1">ims[folder_add].append(image)</span>
            <span class="s1">lns.append(len(ims[folder_add]))</span>
    <span class="s1">mx = max(lns)</span>
    <span class="s1">fin_ims = []</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(mx):</span>
        <span class="s1">start = </span><span class="s2">True</span>
        <span class="s1">print(len(fin_ims))</span>

        <span class="s2">for </span><span class="s1">folder_add </span><span class="s2">in </span><span class="s1">folder_adds:</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s1">curr = ims[folder_add][i]</span>
            <span class="s2">except </span><span class="s1">IndexError:</span>
                <span class="s2">continue</span>
            <span class="s2">if </span><span class="s1">start:</span>
                <span class="s1">fin_ims.append(curr)</span>
                <span class="s1">start = </span><span class="s2">False</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">fin_ims[-</span><span class="s3">1</span><span class="s1">] = cv2.add(fin_ims[-</span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">curr)</span>

    <span class="s1">os.mkdir(dest_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">added&quot;</span><span class="s1">)</span>
    <span class="s2">for </span><span class="s1">image</span><span class="s2">, </span><span class="s1">i </span><span class="s2">in </span><span class="s1">zip(fin_ims</span><span class="s2">, </span><span class="s1">reversed(range(len(fin_ims)))):</span>
        <span class="s1">image = Image.fromarray(image)</span>
        <span class="s1">dest = dest_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">added&quot; </span><span class="s1">+ </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
        <span class="s1">i += </span><span class="s3">1</span>
        <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">explode_gif(gif_paths</span><span class="s2">, </span><span class="s1">folder_add</span><span class="s2">, </span><span class="s1">dest_name=</span><span class="s4">&quot;added&quot;</span><span class="s1">):</span>
    <span class="s1">gif = Image.open(gif_paths)</span>
    <span class="s1">os.mkdir(folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_name)</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(gif.n_frames):</span>
        <span class="s1">gif.seek(i)</span>
        <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest_name + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
        <span class="s1">i += </span><span class="s3">1</span>
        <span class="s1">gif.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">fu_folder(folder_add: str</span><span class="s2">, </span><span class="s1">func=</span><span class="s2">None</span><span class="s1">):</span>
    <span class="s5">&quot;&quot;&quot; 
    operated the function on all images on add. MUST BE IMAGES! 
    todo: exceptions for non-images, reading prog 
    :param folder_add: address 
    :param func: applied function. only on imges (if not use lambda) 
    :return: none 
    &quot;&quot;&quot;</span>
    <span class="s1">print(str(func))</span>
    <span class="s1">func_name = str(func).split(</span><span class="s4">&quot; &quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">func_name = </span><span class="s4">''</span><span class="s1">.join(c </span><span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">func_name </span><span class="s2">if </span><span class="s1">c.isalnum() </span><span class="s2">or </span><span class="s1">c </span><span class="s2">in </span><span class="s4">'-_'</span><span class="s1">)</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">os.makedirs((folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ func_name)</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">i = </span><span class="s3">0</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fpt = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fpt</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">image = func(image)</span>
            <span class="s1">image = Image.fromarray(image)</span>
            <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ func_name + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">i += </span><span class="s3">1</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>
        <span class="s2">break</span>


<span class="s2">def </span><span class="s1">color_gradient_shift():</span>
    <span class="s0"># Load images (same size, 3 channels)</span>
    <span class="s1">img1 = imread_for_utf8(</span>
        <span class="s4">r&quot;C:\pgmr\simData\prorgs base colorized in format noised.png&quot;</span><span class="s2">,</span>
        <span class="s1">mode=</span><span class="s3">1</span><span class="s1">).astype(np.float32) / </span><span class="s3">255.0</span>
    <span class="s1">img2 = imread_for_utf8(</span><span class="s4">r&quot;C:\pgmr\simData\map lines noised formated.png&quot;</span><span class="s2">,</span>
                           <span class="s1">mode=</span><span class="s3">1</span><span class="s1">).astype(np.float32) / </span><span class="s3">255.0</span>
    <span class="s1">output_folder = </span><span class="s4">r&quot;C:\pgmr\simData\frames_vector_delay&quot;</span>
    <span class="s1">num_frames = </span><span class="s3">60</span>

    <span class="s0"># === SETUP ===</span>
    <span class="s1">os.makedirs(output_folder)</span>

    <span class="s2">assert </span><span class="s1">img1.shape == img2.shape</span><span class="s2">, </span><span class="s4">&quot;Images must be the same size.&quot;</span>

    <span class="s1">h</span><span class="s2">, </span><span class="s1">w</span><span class="s2">, </span><span class="s1">_ = img1.shape</span>
    <span class="s1">center = np.array([w / </span><span class="s3">2</span><span class="s2">, </span><span class="s1">h / </span><span class="s3">2</span><span class="s1">])</span>

    <span class="s0"># Compute per-pixel normalized distance from center</span>
    <span class="s1">Y</span><span class="s2">, </span><span class="s1">X = np.meshgrid(np.arange(h)</span><span class="s2">, </span><span class="s1">np.arange(w)</span><span class="s2">, </span><span class="s1">indexing=</span><span class="s4">'ij'</span><span class="s1">)</span>
    <span class="s1">coords = np.stack([X</span><span class="s2">, </span><span class="s1">Y]</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s3">1</span><span class="s1">).astype(np.float32)</span>
    <span class="s1">dist = np.linalg.norm(coords - center</span><span class="s2">, </span><span class="s1">axis=-</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">dist_norm = dist / dist.max()</span>

    <span class="s0"># Delay map: pixels near edges start earlier, center starts later</span>
    <span class="s1">delay_map = </span><span class="s3">1.0 </span><span class="s1">- dist_norm  </span><span class="s0"># 1.0 at center, 0.0 at edges</span>

    <span class="s0"># === ANIMATION FRAMES ===</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(num_frames):</span>
        <span class="s1">print(i)</span>
        <span class="s1">t = i / (num_frames - </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">blend_factor = np.clip((t - delay_map) / (</span><span class="s3">1 </span><span class="s1">- delay_map + </span><span class="s3">1e-5</span><span class="s1">)</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">blend_factor = blend_factor[:</span><span class="s2">, </span><span class="s1">:</span><span class="s2">, </span><span class="s1">np.newaxis]  </span><span class="s0"># for broadcasting</span>

        <span class="s1">frame = img1 * (</span><span class="s3">1 </span><span class="s1">- blend_factor) + img2 * blend_factor</span>
        <span class="s1">frame_uint8 = (frame * </span><span class="s3">255</span><span class="s1">).astype(np.uint8)</span>
        <span class="s1">frame_uint8 = cv2.cvtColor(frame_uint8</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB)</span>

        <span class="s1">image = Image.fromarray(frame_uint8)</span>
        <span class="s1">dest = output_folder + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
        <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>

    <span class="s1">print(</span><span class="s4">&quot;Done! Frames saved to:&quot;</span><span class="s2">, </span><span class="s1">output_folder)</span>


<span class="s2">def </span><span class="s1">temp():</span>
    <span class="s2">pass</span><span class="s0">#add = r</span>


<span class="s2">def </span><span class="s1">zoom_frames(img: np.ndarray</span><span class="s2">, </span><span class="s1">output_dir</span><span class="s2">, </span><span class="s1">zoom_frame</span><span class="s2">, </span><span class="s1">crop_frame</span><span class="s2">, </span><span class="s1">res=(</span><span class="s3">1080</span><span class="s2">, </span><span class="s3">1080</span><span class="s1">)</span><span class="s2">, </span><span class="s1">num_frames=</span><span class="s3">60</span><span class="s1">):</span>
    <span class="s1">os.makedirs(output_dir)</span>

    <span class="s0"># === Load image ===</span>
    <span class="s1">h_img</span><span class="s2">, </span><span class="s1">w_img = img.shape[:</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s0"># x_max, y_max, x_min, y_min</span>
    <span class="s1">stb = h_img</span><span class="s2">, </span><span class="s1">w_img</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span>

    <span class="s2">def </span><span class="s1">interpolate_box(start_box</span><span class="s2">, </span><span class="s1">end_box</span><span class="s2">, </span><span class="s1">t):</span>
        <span class="s5">&quot;&quot;&quot;Linear interpolation of two boxes&quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">tuple(</span>
            <span class="s1">int(s + (e - s) * t)</span>
            <span class="s2">for </span><span class="s1">s</span><span class="s2">, </span><span class="s1">e </span><span class="s2">in </span><span class="s1">zip(start_box</span><span class="s2">, </span><span class="s1">end_box)</span>
        <span class="s1">)</span>

    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(num_frames):</span>
        <span class="s1">t = i / (num_frames - </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">z_box = interpolate_box(stb</span><span class="s2">, </span><span class="s1">zoom_frame</span><span class="s2">, </span><span class="s1">t)</span>
        <span class="s1">x_max</span><span class="s2">, </span><span class="s1">y_max</span><span class="s2">, </span><span class="s1">x_min</span><span class="s2">, </span><span class="s1">y_min = z_box</span>

        <span class="s0"># Width and height of crop window</span>
        <span class="s1">crop_w = x_max - x_min</span>
        <span class="s1">crop_h = y_max - y_min</span>

        <span class="s0"># Create black canvas</span>
        <span class="s1">cropped = np.zeros((crop_h</span><span class="s2">, </span><span class="s1">crop_w</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.uint8)</span>

        <span class="s0"># Compute valid area inside image</span>
        <span class="s1">src_x1 = max(x_min</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">src_y1 = max(y_min</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">src_x2 = min(x_max</span><span class="s2">, </span><span class="s1">w_img)</span>
        <span class="s1">src_y2 = min(y_max</span><span class="s2">, </span><span class="s1">h_img)</span>

        <span class="s0"># Corresponding area in cropped canvas</span>
        <span class="s1">dst_x1 = src_x1 - x_min</span>
        <span class="s1">dst_y1 = src_y1 - y_min</span>
        <span class="s1">dst_x2 = dst_x1 + (src_x2 - src_x1)</span>
        <span class="s1">dst_y2 = dst_y1 + (src_y2 - src_y1)</span>
        <span class="s1">cropped[dst_y1:dst_y2</span><span class="s2">, </span><span class="s1">dst_x1:dst_x2] = img[src_y1:src_y2</span><span class="s2">, </span><span class="s1">src_x1:src_x2]</span>

        <span class="s0"># Resize to fixed output size</span>
        <span class="s1">frame = cv2.resize(cropped</span><span class="s2">, </span><span class="s1">res</span><span class="s2">, </span><span class="s1">interpolation=cv2.INTER_LINEAR)</span>

        <span class="s1">c_box = interpolate_box((*res</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">crop_frame</span><span class="s2">, </span><span class="s1">t)</span>
        <span class="s1">x_max</span><span class="s2">, </span><span class="s1">y_max</span><span class="s2">, </span><span class="s1">x_min</span><span class="s2">, </span><span class="s1">y_min = c_box</span>

        <span class="s0"># Create black canvas</span>
        <span class="s1">cropped2 = np.zeros((*res</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.uint8)</span>

        <span class="s1">cropped2[y_min:y_max</span><span class="s2">, </span><span class="s1">x_min:x_max] = frame[y_min:y_max</span><span class="s2">, </span><span class="s1">x_min:x_max]</span>

        <span class="s0"># Save frame</span>
        <span class="s1">image = Image.fromarray(cropped2)</span>
        <span class="s1">dest = output_dir + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
        <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>

    <span class="s1">print(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">num_frames</span><span class="s2">} </span><span class="s4">frames saved in '</span><span class="s2">{</span><span class="s1">output_dir</span><span class="s2">}</span><span class="s4">'&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">rtl_shift(img1: str</span><span class="s2">, </span><span class="s1">img2: str</span><span class="s2">, </span><span class="s1">start=</span><span class="s3">369</span><span class="s2">, </span><span class="s1">end=</span><span class="s3">734</span><span class="s2">, </span><span class="s1">output_dir=</span><span class="s4">&quot;output_dir&quot;</span><span class="s2">, </span><span class="s1">base_path=BASE_DIR</span><span class="s2">, </span><span class="s1">num_frames=</span><span class="s3">80</span><span class="s1">):</span>
    <span class="s1">PX_SHIFT = </span><span class="s3">734</span><span class="s1">-</span><span class="s3">711</span>
    <span class="s1">start -= PX_SHIFT</span>
    <span class="s0"># end -= PX_SHIFT</span>
    <span class="s1">img1 = imread_for_utf8(img1</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">img2 = imread_for_utf8(img2</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
    <span class="s1">output_dir = base_path + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ output_dir</span>
    <span class="s1">os.makedirs(output_dir</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s0"># Ensure same size</span>
    <span class="s1">h</span><span class="s2">, </span><span class="s1">w = img1.shape[:</span><span class="s3">2</span><span class="s1">]</span>
    <span class="s1">img2 = cv2.resize(img2</span><span class="s2">, </span><span class="s1">(w</span><span class="s2">, </span><span class="s1">h))</span>

    <span class="s0"># === Prepare mask of img2 non-black pixels ===</span>
    <span class="s1">non_black_mask = np.any(img2 != [</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">axis=</span><span class="s3">2</span><span class="s1">).astype(np.uint8)  </span><span class="s0"># 1 where non-black</span>
    <span class="s1">print(</span><span class="s4">&quot;mask generated&quot;</span><span class="s1">)</span>
    <span class="s0"># === Generate frames ===</span>
    <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(num_frames):</span>
        <span class="s1">t = i / (num_frames - </span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">print(t)</span>
        <span class="s1">x_progress = int((end - start) * t) + start</span>
        <span class="s1">frame = img1.copy()</span>
        <span class="s2">for </span><span class="s1">y </span><span class="s2">in </span><span class="s1">range(</span><span class="s3">0</span><span class="s2">, </span><span class="s1">h):</span>
            <span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">range(w - x_progress</span><span class="s2">, </span><span class="s1">end):</span>
                <span class="s2">if </span><span class="s1">non_black_mask[y</span><span class="s2">, </span><span class="s1">x]:</span>
                    <span class="s1">frame[y</span><span class="s2">, </span><span class="s1">x] = img2[y</span><span class="s2">, </span><span class="s1">x]</span>

        <span class="s0"># Save frame</span>
        <span class="s1">frame = to_pil(frame)</span>
        <span class="s1">dest = output_dir + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
        <span class="s1">frame.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>

    <span class="s1">print(</span><span class="s4">f&quot;</span><span class="s2">{</span><span class="s1">num_frames</span><span class="s2">} </span><span class="s4">frames saved in '</span><span class="s2">{</span><span class="s1">output_dir</span><span class="s2">}</span><span class="s4">'&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">position_img(img: np.ndarray</span><span class="s2">, </span><span class="s1">loc: tuple</span><span class="s2">, </span><span class="s1">background=(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">bg_size=(</span><span class="s3">1080</span><span class="s2">, </span><span class="s3">1080</span><span class="s1">)) -&gt; np.ndarray:</span>
    <span class="s5">&quot;&quot;&quot; 
    position img in reformatted bg 
    :param img: img to position 
    :param loc: position location, format x_max, y_max, x_min, y_min 
    :param background: background color, 3d vector 0-255 
    :param bg_size: background size (wh) 
    :return: position img, np.ndarray (cv2) 
    &quot;&quot;&quot;</span>
    <span class="s1">x_max</span><span class="s2">, </span><span class="s1">y_max</span><span class="s2">, </span><span class="s1">x_min</span><span class="s2">, </span><span class="s1">y_min = loc</span>
    <span class="s1">img = img.copy()</span>
    <span class="s1">img = cv2.resize(img</span><span class="s2">, </span><span class="s1">(x_max-x_min</span><span class="s2">, </span><span class="s1">y_max-y_min))</span>
    <span class="s1">base = np.full((*bg_size</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">background</span><span class="s2">, </span><span class="s1">dtype=img.dtype)</span>
    <span class="s1">base[y_min:y_max</span><span class="s2">, </span><span class="s1">x_min:x_max] = img</span>
    <span class="s2">return </span><span class="s1">base</span>


<span class="s2">def </span><span class="s1">position_folder(dir_path: str</span><span class="s2">, </span><span class="s1">loc: tuple</span><span class="s2">, </span><span class="s1">target_path=</span><span class="s4">&quot;position&quot;</span><span class="s2">, </span><span class="s1">background=(</span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s2">, </span><span class="s3">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">bg_size=(</span><span class="s3">1080</span><span class="s2">, </span><span class="s3">1080</span><span class="s1">)):</span>
    <span class="s0"># todo: not only pngs</span>
    <span class="s1">dest = dir_path + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ target_path</span>
    <span class="s1">os.makedirs(dest</span><span class="s2">, </span><span class="s1">exist_ok=</span><span class="s2">True</span><span class="s1">)</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path):</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s2">if </span><span class="s1">fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] != </span><span class="s4">&quot;png&quot;</span><span class="s1">:</span>
                <span class="s2">continue</span>
            <span class="s1">fpf = dir_path + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">img = imread_for_utf8(path=fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">img = position_img(img</span><span class="s2">, </span><span class="s1">loc=loc</span><span class="s2">, </span><span class="s1">background=background</span><span class="s2">, </span><span class="s1">bg_size=bg_size)</span>
            <span class="s1">img = to_pil(img)</span>
            <span class="s1">dest = dir_path + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ target_path + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ fp</span>
            <span class="s1">img.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>
        <span class="s2">break</span>
    <span class="s1">print(</span><span class="s4">&quot;imgs positioned at &quot; </span><span class="s1">+ str(os.path.abspath(dest)))</span>


<span class="s2">def </span><span class="s1">get_last_in_folder(dir_path: str):</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path):</span>
        <span class="s1">fs = []</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s2">if </span><span class="s1">fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] != </span><span class="s4">&quot;png&quot;</span><span class="s1">:</span>
                <span class="s2">continue</span>
            <span class="s1">fpf = dir_path + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">fpf = os.path.abspath(fpf)</span>
            <span class="s1">fs.append(fpf)</span>
        <span class="s1">fs = sorted(fs</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f:float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">].split(</span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot;</span><span class="s1">)[-</span><span class="s3">1</span><span class="s1">]))</span>
        <span class="s2">if </span><span class="s1">len(fs) &gt; </span><span class="s3">0</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">fs[len(fs)-</span><span class="s3">1</span><span class="s1">]</span>
        <span class="s2">raise </span><span class="s1">FileNotFoundError(</span><span class="s4">&quot;folder has no pngs&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">padd_start(folder_add</span><span class="s2">, </span><span class="s1">padd_num</span><span class="s2">, </span><span class="s1">color=</span><span class="s3">0</span><span class="s2">, </span><span class="s1">res=(</span><span class="s3">1080</span><span class="s2">, </span><span class="s3">1080</span><span class="s1">)):</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(folder_add):</span>
        <span class="s1">filenames = sorted(filenames</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: float(f.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">]))</span>
        <span class="s1">i = </span><span class="s3">0</span>
        <span class="s1">ims = []</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s1">fp = folder_add + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
            <span class="s1">image = imread_for_utf8(fp</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
            <span class="s1">image = cv2.cvtColor(image</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB)</span>
            <span class="s1">image = Image.fromarray(image)</span>
            <span class="s1">ims.append(image)</span>
        <span class="s1">img = np.ones((*res</span><span class="s2">, </span><span class="s3">3</span><span class="s1">)</span><span class="s2">, </span><span class="s1">dtype=np.uint8) * color</span>
        <span class="s1">img = Image.fromarray(img)</span>
        <span class="s1">print(len(ims) + padd_num</span><span class="s2">, </span><span class="s4">&quot; padder&quot;</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(padd_num):</span>
            <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ str(i) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">img.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>
        <span class="s2">for </span><span class="s1">image</span><span class="s2">, </span><span class="s1">j </span><span class="s2">in </span><span class="s1">zip(ims</span><span class="s2">, </span><span class="s1">range(len(ims))):</span>
            <span class="s1">dest = folder_add + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ str(j + padd_num) + </span><span class="s4">&quot;.png&quot;</span>
            <span class="s1">image.save(fp=dest</span><span class="s2">, </span><span class="s1">format=</span><span class="s4">'PNG'</span><span class="s1">)</span>
        <span class="s2">break</span>


<span class="s2">def </span><span class="s1">get_frame_num(dir_path=</span><span class="s2">None, </span><span class="s1">gif_path=</span><span class="s2">None</span><span class="s1">):</span>
    <span class="s2">if </span><span class="s1">dir_path </span><span class="s2">is None and </span><span class="s1">gif_path </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s2">raise </span><span class="s1">TypeError(</span><span class="s4">&quot;frame num must get input&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">dir_path </span><span class="s2">is not None and </span><span class="s1">gif_path </span><span class="s2">is not None</span><span class="s1">:</span>
        <span class="s2">raise </span><span class="s1">TypeError(</span><span class="s4">&quot;frame num must get ONE input&quot;</span><span class="s1">)</span>
    <span class="s2">if </span><span class="s1">dir_path </span><span class="s2">is None</span><span class="s1">:</span>
        <span class="s2">if </span><span class="s1">gif_path[-</span><span class="s3">4</span><span class="s1">:] == </span><span class="s4">&quot;.gif&quot;</span><span class="s1">:</span>
            <span class="s1">gif = Image.open(gif_path)</span>
            <span class="s2">return </span><span class="s1">gif.n_frames</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">raise </span><span class="s1">RuntimeWarning(</span><span class="s4">&quot;gif wrong format, trying to open foldr at &quot; </span><span class="s1">+ str(gif_path))</span>
            <span class="s1">dir_path = gif_path</span>
    <span class="s2">if </span><span class="s1">dir_path[-</span><span class="s3">4</span><span class="s1">:] == </span><span class="s4">&quot;.gif&quot;</span><span class="s1">:</span>
        <span class="s2">raise </span><span class="s1">RuntimeWarning(</span><span class="s4">&quot;addres is gif, wrong input :( &quot;</span><span class="s1">)</span>
        <span class="s1">gif = Image.open(dir_path)</span>
        <span class="s2">return </span><span class="s1">gif.n_frames</span>
    <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path):</span>
        <span class="s1">fs = </span><span class="s3">0</span>
        <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
            <span class="s2">if </span><span class="s1">fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] != </span><span class="s4">&quot;png&quot; </span><span class="s2">and </span><span class="s1">fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] != </span><span class="s4">&quot;jpeg&quot; </span><span class="s2">and </span><span class="s1">fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">] != </span><span class="s4">&quot;jpg&quot;</span><span class="s1">:</span>
                <span class="s2">continue</span>
            <span class="s1">fs += </span><span class="s3">1</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s1">float(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])</span>
            <span class="s2">except </span><span class="s1">ValueError:</span>
                <span class="s1">fs -=</span><span class="s3">1</span>
        <span class="s2">return </span><span class="s1">fs</span>


<span class="s2">def </span><span class="s1">gif_to_vid(gif_add: str</span><span class="s2">, </span><span class="s1">vid_add: str):</span>
    <span class="s0"># Load the GIF</span>
    <span class="s1">gif = Image.open(gif_add)</span>

    <span class="s0"># Get size and frame duration</span>
    <span class="s1">width</span><span class="s2">, </span><span class="s1">height = gif.size</span>
    <span class="s1">fps = </span><span class="s3">1000 </span><span class="s1">// gif.info[</span><span class="s4">'duration'</span><span class="s1">]  </span><span class="s0"># duration is in milliseconds per frame</span>
    <span class="s1">print(fps)</span>
    <span class="s0"># Prepare video writer</span>
    <span class="s1">fourcc = cv2.VideoWriter_fourcc(*</span><span class="s4">'mp4v'</span><span class="s1">)  </span><span class="s0"># Or 'XVID'</span>
    <span class="s1">out = cv2.VideoWriter(vid_add</span><span class="s2">, </span><span class="s1">fourcc</span><span class="s2">, </span><span class="s1">fps</span><span class="s2">, </span><span class="s1">(width</span><span class="s2">, </span><span class="s1">height))</span>
    <span class="s1">i = </span><span class="s3">0</span>
    <span class="s0"># Extract and write each frame</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s2">while True</span><span class="s1">:</span>
            <span class="s1">print(i)</span>
            <span class="s1">i += </span><span class="s3">1</span>
            <span class="s0"># Convert PIL image to OpenCV format (BGR)</span>
            <span class="s1">frame = cv2.cvtColor(np.array(gif.convert(</span><span class="s4">&quot;RGB&quot;</span><span class="s1">))</span><span class="s2">, </span><span class="s1">cv2.COLOR_RGB2BGR)</span>
            <span class="s1">out.write(frame)</span>
            <span class="s1">gif.seek(gif.tell() + </span><span class="s3">1</span><span class="s1">)</span>
    <span class="s2">except </span><span class="s1">EOFError </span><span class="s2">as </span><span class="s1">e:</span>
        <span class="s1">print(e)</span>
        <span class="s2">pass  </span><span class="s0"># End of frames</span>

    <span class="s0"># Release everything</span>
    <span class="s1">out.release()</span>
    <span class="s1">print(</span><span class="s4">&quot;Conversion complete!&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">frames_vid(dir_paths: list</span><span class="s2">, </span><span class="s1">dest=</span><span class="s4">&quot;vided&quot;</span><span class="s2">, </span><span class="s1">fps=</span><span class="s3">20.0</span><span class="s2">, </span><span class="s1">res=(</span><span class="s3">1080</span><span class="s2">, </span><span class="s3">1080</span><span class="s1">)):</span>
    <span class="s1">imgs = []</span>
    <span class="s2">for </span><span class="s1">dir_path_i </span><span class="s2">in </span><span class="s1">dir_paths:</span>
        <span class="s2">for </span><span class="s1">(_</span><span class="s2">, </span><span class="s1">dir_names</span><span class="s2">, </span><span class="s1">filenames) </span><span class="s2">in </span><span class="s1">os.walk(dir_path_i):</span>
            <span class="s2">for </span><span class="s1">fp </span><span class="s2">in </span><span class="s1">filenames:</span>
                <span class="s1">fpf = dir_path_i + </span><span class="s4">'</span><span class="s2">\\</span><span class="s4">' </span><span class="s1">+ fp</span>
                <span class="s1">imgs.append((imread_for_utf8(fpf</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span><span class="s2">, </span><span class="s1">float(fp.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">])))</span>
            <span class="s2">break</span>
    <span class="s1">print(</span><span class="s4">f&quot;Load images complete. </span><span class="s2">{</span><span class="s1">len(imgs)</span><span class="s2">} </span><span class="s4">images uploaded&quot;</span><span class="s1">)</span>
    <span class="s1">imgs = sorted(imgs</span><span class="s2">, </span><span class="s1">key=</span><span class="s2">lambda </span><span class="s1">f: f[</span><span class="s3">1</span><span class="s1">])</span>

    <span class="s0"># Prepare video writer</span>
    <span class="s1">fourcc = cv2.VideoWriter_fourcc(*</span><span class="s4">'mp4v'</span><span class="s1">)  </span><span class="s0"># Or 'XVID'</span>
    <span class="s0"># filename: str, fourcc: int, fps: float, frameSize: cv2.typing.Size, isColor</span>
    <span class="s1">out = cv2.VideoWriter(filename=dest</span><span class="s2">, </span><span class="s1">fourcc=fourcc</span><span class="s2">, </span><span class="s1">fps=fps</span><span class="s2">, </span><span class="s1">frameSize=res)</span>

    <span class="s0"># Extract and write each frame</span>
    <span class="s1">i = </span><span class="s3">0</span>
    <span class="s2">for </span><span class="s1">img_and_ind </span><span class="s2">in </span><span class="s1">imgs:</span>
        <span class="s2">if </span><span class="s1">img_and_ind[</span><span class="s3">1</span><span class="s1">] != i:</span>
            <span class="s1">print(</span><span class="s4">&quot;Index &quot; </span><span class="s1">+ str(i) + </span><span class="s4">&quot;skipped. Got &quot; </span><span class="s1">+ str(img_and_ind[</span><span class="s3">1</span><span class="s1">]) + </span><span class="s4">&quot;instead&quot;</span><span class="s1">)</span>
        <span class="s1">i += </span><span class="s3">1</span>
        <span class="s1">print(i)</span>
        <span class="s1">out.write(img_and_ind[</span><span class="s3">0</span><span class="s1">])</span>

    <span class="s0"># Release everything</span>
    <span class="s1">out.release()</span>
    <span class="s1">print(</span><span class="s4">&quot;Video generated at &quot; </span><span class="s1">+ str(os.path.abspath(dest)))</span>


<span class="s2">def </span><span class="s1">reformat_vid_for_web(vid_path: str):</span>
    <span class="s1">vid_repath = vid_path.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">0</span><span class="s1">] + </span><span class="s4">&quot;T.&quot; </span><span class="s1">+ vid_path.split(</span><span class="s4">&quot;.&quot;</span><span class="s1">)[</span><span class="s3">1</span><span class="s1">]</span>
    <span class="s1">ffmpeg.input(vid_path).output(vid_repath</span><span class="s2">, </span><span class="s1">vcodec=</span><span class="s4">'libx264'</span><span class="s2">, </span><span class="s1">acodec=</span><span class="s4">'aac'</span><span class="s1">).run()</span>


<span class="s2">if </span><span class="s1">__name__ == </span><span class="s4">'__main__'</span><span class="s1">:</span>
    <span class="s1">a7 = </span><span class="s4">r&quot;C:\pgmr\gridReveal\shifted\1039.png&quot;</span>
    <span class="s1">a79 = </span><span class="s4">r&quot;C:pgmr\\simData\stages\bg post revel.png&quot;</span>
    <span class="s1">trees_placmet = </span><span class="s4">r&quot;C:\simData\img analog arc\just trees.png&quot;</span>
    <span class="s1">a89 = </span><span class="s4">r&quot;C:\pgmr\simData\stages\a95.png&quot;</span>
    <span class="s1">a9base_folder = </span><span class="s4">r&quot;C:\pgmr\frames_v1_lam_lowed_bg&quot;</span>
    <span class="s1">planned = </span><span class="s4">r&quot;C:\pgmr\simData\img analog arc\planned fin framed.png&quot;</span>
    <span class="s1">planned_with_tza = </span><span class="s4">r&quot;C:\pgmr\simData\img analog arc\planned with tza.png&quot;</span>
    <span class="s1">grid_lst = </span><span class="s4">r&quot;C:\pgmr\simData\img analog arc\vertical pin.png&quot;</span>

    <span class="s2">import </span><span class="s1">time</span>
    <span class="s1">t = time.time()</span>

    <span class="s2">def </span><span class="s1">t_check():</span>
        <span class="s1">print(</span><span class="s4">&quot;TIME: &quot; </span><span class="s1">+ str(time.time() - t))</span>

    <span class="s1">white = (</span><span class="s3">255</span><span class="s2">, </span><span class="s3">255</span><span class="s2">, </span><span class="s3">255</span><span class="s1">)</span>

    <span class="s1">adds = [</span>
            <span class="s4">r&quot;C:\pgmr\simData\zoomGIF&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\s1&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\s2&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\s3&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\s4\shifted&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\s5\shifted&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\gridReveal\shifted&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\pTransAvg\shifted&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\trees\trans\glowed\shifted&quot;</span><span class="s2">,</span>
            <span class="s4">r&quot;C:\pgmr\simData\tree_routs_p_bg\shifted&quot;</span>
            <span class="s1">]</span>

    <span class="s1">frames = {</span>
        <span class="s4">&quot;zoom&quot;</span><span class="s1">: </span><span class="s3">0</span><span class="s2">,</span>
        <span class="s4">&quot;s1&quot;</span><span class="s1">: </span><span class="s3">80</span><span class="s2">,</span>
        <span class="s4">&quot;s2&quot;</span><span class="s1">: </span><span class="s3">240</span><span class="s2">,</span>
        <span class="s4">&quot;s3&quot;</span><span class="s1">: </span><span class="s3">400</span><span class="s2">,</span>
        <span class="s4">&quot;s4&quot;</span><span class="s1">: </span><span class="s3">560</span><span class="s2">,</span>
        <span class="s4">&quot;s5&quot;</span><span class="s1">: </span><span class="s3">720</span><span class="s2">,</span>
        <span class="s4">&quot;grids&quot;</span><span class="s1">: </span><span class="s3">880</span><span class="s2">,</span>
        <span class="s4">&quot;grid fade&quot;</span><span class="s1">: </span><span class="s3">1040</span><span class="s2">,</span>
        <span class="s4">&quot;trees place&quot;</span><span class="s1">: </span><span class="s3">1080</span><span class="s2">,</span>
        <span class="s4">&quot;trees routes&quot;</span><span class="s1">: </span><span class="s3">1260</span>
    <span class="s1">}</span>


    <span class="s2">def </span><span class="s1">fin1(dest=</span><span class="s4">&quot;fin1&quot;</span><span class="s1">):</span>
        <span class="s5">&quot;&quot;&quot; 
        fade bg 
        &quot;&quot;&quot;</span>
        <span class="s1">bg1 = imread_for_utf8(a89</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">bg2 = imread_for_utf8(trees_placmet</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">bg_framese = basic_avg(bg1</span><span class="s2">, </span><span class="s1">bg2</span><span class="s2">, </span><span class="s1">frame_n=</span><span class="s3">200</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s4">&quot;bg genarated&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">f1_t1 = BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ </span><span class="s4">&quot;fade to trees&quot;</span>
        <span class="s1">save_series(bg_framese</span><span class="s2">, </span><span class="s1">loc=f1_t1)</span>
        <span class="s1">print(</span><span class="s4">&quot;bg saved&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">zip_sum_folders(a9base_folder</span><span class="s2">, </span><span class="s1">f1_t1</span><span class="s2">, </span><span class="s1">dest_app=dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;farames genarated&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">save_gif((BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest)</span><span class="s2">, </span><span class="s1">dest=dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;gif saved at &quot; </span><span class="s1">+ BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest)</span>
        <span class="s1">t_check()</span>

    <span class="s2">def </span><span class="s1">fin2(dest=</span><span class="s4">&quot;fin2&quot;</span><span class="s2">, </span><span class="s1">f_t=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">padd=</span><span class="s3">2</span><span class="s1">):</span>
        <span class="s1">start = get_last_in_folder(adds[len(adds) - </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">start = imread_for_utf8(start</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">end = planned</span>
        <span class="s1">end = imread_for_utf8(end</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">lasts = basic_avg(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">frame_n=f_t*</span><span class="s3">50</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s4">&quot;grad generated&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">save_series(lasts</span><span class="s2">, </span><span class="s1">loc=BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;grad saved&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">padd_folder(BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest</span><span class="s2">, </span><span class="s1">time_add=padd)</span>
        <span class="s1">print(</span><span class="s4">&quot;folder padded&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">save_gif_multiple_folders_loose([adds[len(adds) - </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest]</span><span class="s2">, </span><span class="s1">dest=dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;gif saved at &quot; </span><span class="s1">+ BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest + </span><span class="s4">&quot;.gif&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>

    <span class="s2">def </span><span class="s1">fin3(dest=</span><span class="s4">&quot;fin3&quot;</span><span class="s2">, </span><span class="s1">padd=</span><span class="s3">2</span><span class="s1">):</span>
        <span class="s1">gd = imread_for_utf8(grid_lst</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">bg1 = imread_for_utf8(a89</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">bg_framese = basic_avg(bg1</span><span class="s2">, </span><span class="s1">gd</span><span class="s2">, </span><span class="s1">frame_n=</span><span class="s3">200</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s4">&quot;bg genarated&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">f3_t1 = BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ </span><span class="s4">&quot;fade to grid&quot;</span>
        <span class="s1">save_series(bg_framese</span><span class="s2">, </span><span class="s1">loc=f3_t1)</span>
        <span class="s1">print(</span><span class="s4">&quot;bg saved&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">zip_sum_folders(a9base_folder</span><span class="s2">, </span><span class="s1">f3_t1</span><span class="s2">, </span><span class="s1">dest_app=dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;farames genarated&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">padd_folder((BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest)</span><span class="s2">, </span><span class="s1">padd)</span>
        <span class="s1">print(</span><span class="s4">&quot;padded &quot;</span><span class="s2">, </span><span class="s1">padd)</span>
        <span class="s1">t_check()</span>
        <span class="s1">save_gif((BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest)</span><span class="s2">, </span><span class="s1">dest=dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;gif saved at &quot; </span><span class="s1">+ BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest)</span>
        <span class="s1">t_check()</span>

    <span class="s2">def </span><span class="s1">fin4(dest=</span><span class="s4">&quot;fin4&quot;</span><span class="s2">, </span><span class="s1">f_t=</span><span class="s3">4</span><span class="s2">, </span><span class="s1">padd=</span><span class="s3">2</span><span class="s1">):</span>
        <span class="s1">start = get_last_in_folder(adds[len(adds) - </span><span class="s3">1</span><span class="s1">])</span>
        <span class="s1">start = imread_for_utf8(start</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">end = planned_with_tza</span>
        <span class="s1">end = imread_for_utf8(end</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">lasts = basic_avg(start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">frame_n=f_t*</span><span class="s3">50</span><span class="s1">)</span>
        <span class="s1">print(</span><span class="s4">&quot;grad generated&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">save_series(lasts</span><span class="s2">, </span><span class="s1">loc=BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;grad saved&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">padd_folder(BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest</span><span class="s2">, </span><span class="s1">time_add=padd)</span>
        <span class="s1">print(</span><span class="s4">&quot;folder padded&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">save_gif_multiple_folders_loose([adds[len(adds) - </span><span class="s3">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest]</span><span class="s2">, </span><span class="s1">dest=dest)</span>
        <span class="s1">print(</span><span class="s4">&quot;gif saved at &quot; </span><span class="s1">+ BASE_DIR + </span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">&quot; </span><span class="s1">+ dest + </span><span class="s4">&quot;.gif&quot;</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s2">pass</span>

    <span class="s1">v_a = </span><span class="s4">r&quot;C:\pgmr\simData\pre_lst.mp4&quot;</span>
    <span class="s1">frames_vid(adds</span><span class="s2">, </span><span class="s1">dest=v_a)</span>
    <span class="s1">t_check()</span>
    <span class="s1">reformat_vid_for_web(v_a)</span>
    <span class="s1">t_check()</span>
    <span class="s0"># save_gif_multiple_folders(adds, dest=&quot;part_2p1&quot;, tim=50)</span>
    <span class="s0"># t_check()</span>
    <span class="s1">t_check()</span>
    <span class="s1">print(</span><span class="s4">&quot;END!&quot;</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">a8():</span>
        <span class="s1">location = (</span><span class="s3">734</span><span class="s2">, </span><span class="s3">1061</span><span class="s2">, </span><span class="s3">369</span><span class="s2">, </span><span class="s3">16</span><span class="s1">)</span>
        <span class="s1">position_folder(</span><span class="s4">r&quot;C:\pgmr\simData\trees&quot;</span><span class="s2">, </span><span class="s1">location</span><span class="s2">, </span><span class="s1">background=white)</span>
        <span class="s1">fu_folder(</span><span class="s4">r&quot;C:\pgmr\simData\trees\position&quot;</span><span class="s2">, </span><span class="s1">func=op_glow)</span>
        <span class="s1">a_add = </span><span class="s4">r&quot;C:\pgmr\simData\trees\trans&quot;</span>
        <span class="s1">t_add = </span><span class="s4">r&quot;C:\pgmr\simData\trees\position\op_glow&quot;</span>
        <span class="s1">oop_folder_to_folder_t(target_folder_add=a_add</span><span class="s2">, </span><span class="s1">source_folder_add=t_add)</span>

    <span class="s2">def </span><span class="s1">a9():</span>
        <span class="s1">shift_folder(</span><span class="s4">r&quot;C:\pgmr\simData\tree_routs_p_bg&quot;</span><span class="s2">, </span><span class="s3">1260</span><span class="s1">)</span>
        <span class="s1">t_check()</span>

    <span class="s2">def </span><span class="s1">a1():</span>
        <span class="s1">image = </span><span class="s4">r&quot;C:\pgmr\background.png&quot;</span>
        <span class="s1">dst = </span><span class="s4">r&quot;C:\pgmr\simData\zoomGIF&quot;</span>
        <span class="s1">image = imread_for_utf8(image</span><span class="s2">, </span><span class="s1">mode=</span><span class="s3">1</span><span class="s1">)</span>
        <span class="s1">image = cv2.cvtColor(image</span><span class="s2">, </span><span class="s1">cv2.COLOR_BGR2RGB)</span>
        <span class="s0"># x_max, y_max, x_min, y_min</span>
        <span class="s1">zf = (</span><span class="s3">2750</span><span class="s2">, </span><span class="s3">2559</span><span class="s2">, </span><span class="s3">1670</span><span class="s2">, </span><span class="s3">1478</span><span class="s1">)  </span><span class="s0"># final zoomed-in</span>
        <span class="s1">cf = (</span><span class="s3">734</span><span class="s2">, </span><span class="s3">1061</span><span class="s2">, </span><span class="s3">369</span><span class="s2">, </span><span class="s3">16</span><span class="s1">)  </span><span class="s0"># final crop</span>
        <span class="s1">zoom_frames(image</span><span class="s2">, </span><span class="s1">dst</span><span class="s2">, </span><span class="s1">zf</span><span class="s2">, </span><span class="s1">cf)</span>

    <span class="s2">def </span><span class="s1">s_n(n: int):</span>
        <span class="s1">a1_add = </span><span class="s4">r&quot;C:\pgmr\simData\s&quot;</span><span class="s1">+str(n-</span><span class="s3">1</span><span class="s1">)+</span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">79.png&quot;</span>
        <span class="s1">s1_add = </span><span class="s4">r&quot;C:\pgmr\simData\stages\s&quot;</span><span class="s1">+str(n)+</span><span class="s4">&quot;</span><span class="s2">\\</span><span class="s4">.png&quot;</span>
        <span class="s1">rtl_shift(a1_add</span><span class="s2">, </span><span class="s1">s1_add</span><span class="s2">, </span><span class="s1">output_dir=(</span><span class="s4">&quot;s&quot;</span><span class="s1">+str(n)))</span>
        <span class="s1">t_check()</span>
        <span class="s1">add = </span><span class="s4">r&quot;C:\pgmr\simData\s&quot;</span><span class="s1">+str(n)</span>
        <span class="s1">padd_folder(add</span><span class="s2">, </span><span class="s1">time_add=</span><span class="s3">4.0</span><span class="s1">)</span>
        <span class="s1">t_check()</span>
        <span class="s1">print(</span><span class="s4">&quot;Finished rlt shift st=&quot; </span><span class="s1">+ str(n))</span>
</pre>
</body>
</html>